# Day 1 — 블록체인 핵심 개념

## 트랜잭션 라이프사이클
- 사용자가 서명한 트랜잭션은 일단 P2P 네트워크에 브로드캐스트되어 메모리풀(Mempool)에 저장된다.  
- 검증 노드는 트랜잭션의 서명과 논스, 가스 한도, 잔액을 확인한 뒤 블록 제안 시 포함시킨다.  
- 이더리움의 PoS 체인에서는 검증인이 슬롯마다 블록을 제안하고, 다른 검증인들이 서명(Attestation)으로 블록을 승인한다.  
- 블록에 포함된 트랜잭션은 가스 비용이 차감되고, 실행 결과(상태 변화, 이벤트 로그)가 체인에 기록된다.

## EVM 내부 동작
- EVM은 스택 기반 가상머신으로, 명령어 대부분이 256비트 단위의 스택을 조작한다.  
- 컨트랙트의 상태 변수는 32바이트 슬롯에 저장되며, `mapping`은 키의 keccak 해시를 이용해 슬롯 위치를 결정한다.  
- 함수 호출 시 `msg.sender`, `msg.value`, `block.timestamp` 같은 컨텍스트 변수가 자동으로 채워진다.  
- `require`가 실패하면 EVM은 상태 변경을 모두 되돌리고(Atomicity), revert 데이터를 호출자에게 전달한다.

## 이벤트 인덱싱
- 이벤트는 트랜잭션 로그에 기록되며, 최대 3개의 `indexed` 파라미터를 주어 검색을 빠르게 할 수 있다.  
- `indexed` 필드는 토픽(Topic)으로 저장되어 특정 주소나 값과 매칭되는 이벤트를 효율적으로 찾게 해 준다.  
- 나머지 파라미터는 `data` 필드에 직렬화되어 저장된다. 따라서 입금 기록을 추적하려면 `Deposited` 이벤트에 `account`를 `indexed`로 두어야 한다.

## 가스와 수수료
- 각 연산은 가스를 소비하며, 트랜잭션 발신자가 `gasLimit * gasPrice`만큼의 ETH를 미리 예치한다.  
- 사용하지 않은 가스는 트랜잭션 종료 시 환불된다.  
- 스토리지에 0이 아닌 값을 처음 기록할 때가 가장 비싸므로, 상태 변수 사용을 최소화하는 것이 좋다.  
- `forge test --gas-report`를 통해 함수별 가스 사용량을 측정하고, 추후 최적화 시 참고한다.
