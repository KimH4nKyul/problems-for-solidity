# Day 2 — YOU_MUST_KNOW

## 컴퓨터 공학 지식 정리
- **상태 기계(State Machine) 사고방식**  
  스마트 컨트랙트는 입력에 따라 상태가 변하는 유한 상태 기계로 볼 수 있다. `balances`와 `totalDeposits`는 상태를 나타내는 변수이며, 입금/출금 함수는 상태 전이 함수다. 상태 전이가 끝날 때 불변식(예: `sum(balances) == totalDeposits`)이 항상 유지되는지 확인해야 한다. 이를 위해 각 함수 마지막에 상태가 기대한 대로 업데이트되었는지를 테스트로 보증한다.
- **불변식(Invariant)**  
  불변식은 항상 참이어야 하는 논리식이다. 예를 들어 `totalDeposits`는 각 사용자 잔액의 합과 같아야 하고, 각 `balances[addr]`는 음수가 될 수 없다. 이러한 불변식을 수학적으로 정의해 두면 테스트 설계가 쉬워지고, 후속 과제에서 퍼징이나 형식 검증을 적용할 때 토대가 된다.
- **ABI 인코딩**  
  Solidity 함수 호출과 revert 데이터는 모두 ABI(Application Binary Interface) 형식으로 인코딩된다. 커스텀 에러는 `selector(4 bytes) + arguments` 구조를 갖는다. 테스트에서 `abi.encodeWithSelector`를 사용하면 revert 데이터가 정확한지 비교할 수 있다. 이는 해시 충돌을 피하고, 문자열 비교보다 효율적이다.

## 금융 공학 지식
- **예치 잔액 관리(Accounting)**  
  금융 시스템에서 잔액 관리는 회계(ledger)의 핵심이다. 각 사용자의 잔액과 전체 잔액이 항상 일치해야 하며, 입금과 출금은 반드시 두 변수에 동시에 반영되어야 한다. 이를 `이중 기록(double-entry)`라 부르며, 스마트 컨트랙트에서도 동일한 원리가 적용된다.
- **최소 입금 금액(Minimum Deposit)**  
  은행이나 예치 상품에서는 처리 비용이나 리스크 관리 때문에 최소 입금 금액을 정한다. 스마트 컨트랙트에서도 너무 작은 금액은 가스 비용 대비 효율이 떨어질 수 있고, 스팸 트랜잭션을 유발할 수 있다. `minDeposit` 설정은 이러한 경제적 고려를 코드로 반영한 예시다.
- **유동성 관리(Liquidity Management)**  
  출금 로직은 컨트랙트가 언제든 사용자 자금을 반환할 준비가 되어 있어야 한다는 의미다. 출금 조건과 실패 처리(예: 외부 전송 실패 시 revert)는 유동성 리스크를 줄이는 장치로 볼 수 있다.
