# Day 4 BLOCKCHAIN KNOWLEDGE

1. **머클 루트와 온체인 검증**: 온체인 컨트랙트는 전체 분배 목록을 저장하지 않고 루트 한 개만 저장합니다. 사용자는 자신의 leaf와 proof를 전달하면, 컨트랙트가 `MerkleProof.verify(proof, root, leaf)`로 유효성을 판단합니다. 이는 온체인 저장 비용을 크게 절감합니다.
2. **Epoch 설계**: 에어드롭을 여러 차례 나눠 배포할 때 epoch 번호로 버전을 나누면 루트 교체와 예치 잔액 관리가 명확해집니다. epoch는 반드시 단조 증가해야 과거 기록이 덮어쓰이지 않습니다.
3. **이벤트 기반 회계**: `EpochFunded`, `Claimed` 같은 이벤트는 온체인 인덱서를 통해 감사 로그를 만들 때 핵심 근거가 됩니다. 이벤트 인자는 `indexed` 키워드를 활용해 특정 epoch/사용자를 빠르게 필터링할 수 있습니다.
4. **ERC20 상호작용 패턴**: `transfer`/`transferFrom`이 false를 반환할 수 있다는 점을 항상 확인해야 합니다. 또한 fee-on-transfer 토큰을 다룰 때는 실제 수령 금액이 덜 들어올 수 있으므로 epoch 잔액 검사 직후 바로 상태를 업데이트해야 합니다.
5. **테스트에서의 머클 증명**: Foundry 테스트는 Solidity에서 직접 머클 proof를 계산할 수 있습니다. 소규모 트리를 수동으로 구성해 leaf와 proof를 명시적으로 작성하면, 오프체인 스크립트 없이도 재현 가능한 테스트가 됩니다.
